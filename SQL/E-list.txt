/*create database for e-list*/
CREATE DATABASE elist
/*create table for e-list*/
USE elist
GO
SET ANSI_NULLS ON
GO
CREATE TABLE [dbo].[Tasks](
[task_id] [UNIQUEIDENTIFIER],
[task_name] [NVARCHAR](100) NOT NULL,
[task_description] [NVARCHAR](1000)NULL,
[task_created] [DATETIME]NULL,
[task_status] [BIT]NULL,
[due_date] [DATETIME] NULL,
CONSTRAINT [PK_task_id] PRIMARY KEY CLUSTERED
(
[task_id] DESC
)WITH(PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]

exec sp_rename'dbo.Tasks.task_status', 'task_isactive', 'COLUMN';


/* set active task to inactive*/
CREATE PROCEDURE [dbo].[deleteActiveTasks]
@task_id uniqueidentifier
AS
BEGIN 
UPDATE Tasks
SET task_isactive =  0
WHERE task_id = @task_id
END

/* get active task*////////
CREATE PROCEDURE [dbo].[getActivetask]
AS 
BEGIN
SELECT task_id,task_name, task_description,
task_created, due_date,
ISNULL(task_isactive, 1) AS ISACTIVE
FROM Tasks
WHERE task_isactive = 1
ORDER BY task_created DESC
END

DROP PROCEDURE [dbo].[getActivetask]

/* get all task*///////
CREATE PROCEDURE [dbo].[getAlltask]
AS
BEGIN
SELECT task_id,
task_name,task_description,
task_created, due_date,
ISNULL(task_isactive, '') AS ISACTIVE
FROM Tasks ORDER BY task_created DESC
END



/* get inactive task*/////
drop procedure getInactivetask
exec getInactivetask

CREATE PROCEDURE [dbo].[getInactivetask]
AS
BEGIN
SELECT task_id,task_name, task_description,
ISNULL(task_isactive, 0) AS ISACTIVE
FROM Tasks WHERE task_isactive = 0
ORDER BY task_created DESC
END


/* get all task by id */////


CREATE PROCEDURE [dbo].[getTasksbyId]
@task_id UNIQUEIDENTIFIER
AS
BEGIN
SELECT task_id,
task_name,task_description,
task_created, due_date,
ISNULL(task_isactive, 1) AS ISACTIVE
FROM Tasks
WHERE task_id = @task_id
END



/*   get task by task name *//////
CREATE PROCEDURE [dbo].[getTaskbyName]
@task_name NVARCHAR(100)
AS
BEGIN
SELECT task_id,
task_name, task_description,
task_created, due_date,
ISNULL(task_isactive, 1) AS ISACTIVE
FROM Tasks
WHERE task_name = @task_name
END

/* insert new task */
CREATE PROCEDURE [dbo].[insertNewTask]
(
@task_id UNIQUEIDENTIFIER,
@task_name NVARCHAR(100),
@task_description NVARCHAR(1000),
@due_date DATETIME,
@task_isactive BIT
)
AS
BEGIN

IF EXISTS(SELECT task_id FROM Tasks WHERE task_id = @task_id)
BEGIN
UPDATE Tasks
SET task_name = @task_name,
task_description = @task_description,
task_isactive = @task_isactive,
task_created = GETDATE(),
due_date = @due_date
WHERE task_id = @task_id
END

ELSE
BEGIN
INSERT INTO Tasks(task_id, task_name, task_description, task_isactive, task_created, due_date)
VALUES(NEWID(), @task_name, @task_description, 1, GETDATE(), @due_date)
END

END


